<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.spring.myapp.informationBoard.repository.InformationMapper">
    <resultMap id="InfoResultMap" type="com.spring.myapp.informationBoard.model.Information">
        <id property="infoId" column="info_id"/>
        <id property="userId" column="user_id"/>
        <id property="categoryId" column="category_id"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="imageUrl" column="image_url"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <result property="viewCount" column="view_count"/>
        <result property="isDeleted" column="is_deleted"/>
        <association property="categoryName" column="category_id"
                     select="findCategoryForInfo"
        />
        <association property="nickname" column="user_id"
                     select="findUserForInfo"/>
    </resultMap>

    <select id="findAll" resultMap="InfoResultMap">
        SELECT * FROM info
    </select>

    <select id="findCategoryForInfo" resultType="string">
        SELECT ic.category_name
        FROM info_categories ic
        WHERE ic.category_id = #{category_id}
    </select>

    <select id="findUserForInfo" resultType="string">
        SELECT u.nickname
        FROM users u
        WHERE u.user_id = #{user_id}
    </select>

    <insert id="writeNewInfo" parameterType="com.spring.myapp.informationBoard.model.Information">
        INSERT INTO info (info_id, user_id, category_id, title, content, image_url, created_at, updated_at, view_count,
        is_deleted)
        VALUES (#{infoId}, #{userId}, #{categoryId}, #{title}, #{content}, #{imageUrl}, #{createdAt}, #{updatedAt},
        #{viewCount}, #{isDeleted})
    </insert>

    <!--    <select id="findById" parameterType="map" resultMap="InfoResultMap">-->
    <!--        SELECT * FROM information-->
    <!--        WHERE info_id = #{infoId} AND user_id = #{userId} AND category_id = #{categoryId}-->
    <!--    </select>-->

    <!--    <insert id="insert" parameterType="InfoResultMap">-->
    <!--        INSERT INTO information (info_id, user_id, category_id, title, content, image_url, created_at, updated_at,-->
    <!--        view_count, is_deleted)-->
    <!--        VALUES (#{infoId}, #{userId}, #{categoryId}, #{title}, #{content}, #{imageUrl}, #{createdAt}, #{updatedAt},-->
    <!--        #{viewCount}, #{isDeleted})-->
    <!--    </insert>-->

    <!--    <update id="update" parameterType="InfoResultMap">-->
    <!--        UPDATE information-->
    <!--        SET title = #{title}, content = #{content}, image_url = #{imageUrl},-->
    <!--        created_at = #{createdAt}, updated_at = #{updatedAt}, view_count = #{viewCount}, is_deleted = #{isDeleted}-->
    <!--        WHERE info_id = #{infoId} AND user_id = #{userId} AND category_id = #{categoryId}-->
    <!--    </update>-->

    <!--    <delete id="delete" parameterType="map">-->
    <!--        DELETE FROM information-->
    <!--        WHERE info_id = #{infoId} AND user_id = #{userId} AND category_id = #{categoryId}-->
    <!--    </delete>-->
</mapper>
